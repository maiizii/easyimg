<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>简易图床 - 快速上传与管理图片</title>
    <meta name="description" content="简洁高效的图床服务，支持自定义后端 API 与密钥保护" />
    <link rel="stylesheet" href="/assets/app.css" />
  </head>
  <body>
    <div class="app-shell">
      <header class="topbar">
        <div class="brand">
          <span class="brand-mark">📷</span>
          <div class="brand-text">
            <h1>简易图床</h1>
            <p>快速上传、管理与分享图片</p>
          </div>
        </div>
        <nav class="topnav" aria-label="主要功能">
          <button type="button" class="nav-button active" data-view="upload">上传图片</button>
          <button type="button" class="nav-button" data-view="history">历史记录</button>
          <button type="button" class="nav-button" data-view="settings">设置</button>
          <button type="button" class="nav-button" data-view="api">API</button>
        </nav>
      </header>

      <main class="content" id="main-content">
        <section id="view-upload" class="view active" aria-labelledby="upload-title">
          <div class="panel">
            <div class="panel-header">
              <h2 id="upload-title">上传图片</h2>
              <p class="muted">直接拖拽或点击选择文件，支持一次上传多张图片，最大 10 MB / 张</p>
              <p id="upload-warning" class="warning hidden">⚠️ 请先在设置中保存 API 地址和密钥后再上传图片</p>
            </div>
            <div class="upload-area" id="upload-dropzone" tabindex="0" role="button" aria-label="点击或拖拽上传图片">
              <div class="dropzone-icon">⬆️</div>
              <p class="dropzone-title">拖拽图片到这里或点击选择</p>
              <p class="dropzone-hint">支持 PNG、JPG、GIF 等常见格式</p>
              <button type="button" class="secondary" id="trigger-file">选择图片</button>
              <input id="imageFiles" type="file" accept="image/*" multiple hidden />
            </div>
            <div class="panel-actions">
              <button id="upload-button" type="button">开始上传</button>
              <button type="button" class="ghost" id="refresh-history">刷新图片列表</button>
              <button type="button" class="ghost" id="clear-history">清空本地记录</button>
            </div>
          </div>
          <div id="upload-results" class="results-list hidden" aria-live="polite"></div>
        </section>

        <section id="view-history" class="view" aria-labelledby="history-title">
          <div class="panel">
            <div class="panel-header">
              <h2 id="history-title">历史上传</h2>
              <p class="muted">查看最近上传的图片，支持复制链接或删除服务器上的文件</p>
              <p id="history-warning" class="warning hidden">⚠️ 需要先配置 API 地址和密钥才能从服务器获取历史记录</p>
            </div>
            <div id="history-list" class="results-list" aria-live="polite"></div>
          </div>
        </section>

        <section id="view-settings" class="view" aria-labelledby="settings-title">
          <div class="panel">
            <div class="panel-header">
              <h2 id="settings-title">连接配置</h2>
              <p class="muted">填写后端服务地址与 API 密钥，保存后即可启用上传功能</p>
            </div>
            <form id="settings-form" class="form-grid">
              <label class="form-item">
                <span class="form-label">API 地址</span>
                <input id="apiUrl" type="url" placeholder="https://img.example.com" required />
                <span class="form-hint">示例：https://img.example.com 或 http://服务器IP:3000</span>
              </label>
              <label class="form-item">
                <span class="form-label">API 密钥（X-API-Key）</span>
                <input id="apiKey" type="text" placeholder="请先在 API 页面生成专属密钥" autocomplete="off" required />
                <span class="form-hint">安全提示：请妥善保管密钥，不要分享给他人</span>
              </label>
              <div class="form-actions">
                <button type="submit">保存配置</button>
              </div>
            </form>
          </div>
        </section>

        <section id="view-api" class="view" aria-labelledby="api-title">
          <div class="panel">
            <div class="panel-header">
              <h2 id="api-title">API 接口</h2>
              <p class="muted">快速查看当前配置并复制示例命令，便于在脚本或其他应用中集成</p>
            </div>
            <div class="api-cards">
              <div class="info-card">
                <h3>生成 API 密钥</h3>
                <p class="muted">输入访问密码即可生成只属于当前客户端的 API 密钥，刷新页面也不会变化。</p>
                <div class="info-item">
                  <span class="info-label">客户端标识</span>
                  <code id="client-id" class="info-value">计算中...</code>
                  <button type="button" class="ghost" id="copy-client-id">复制</button>
                </div>
                <form id="api-key-form" class="form-grid compact">
                  <label class="form-item">
                    <span class="form-label">访问密码</span>
                    <input id="apiPassword" type="password" placeholder="请输入访问密码" autocomplete="current-password" required />
                  </label>
                  <div class="form-actions">
                    <button type="submit" id="generate-api-key">生成密钥</button>
                  </div>
                </form>
                <div class="info-item hidden" id="generated-key-row">
                  <span class="info-label">生成的密钥</span>
                  <code id="generated-key" class="info-value"></code>
                  <div class="result-actions">
                    <button type="button" class="ghost" id="copy-generated-key">复制密钥</button>
                    <button type="button" class="ghost" id="use-generated-key">保存到设置</button>
                  </div>
                </div>
                <p class="muted" id="api-generator-status"></p>
              </div>
              <div class="info-card">
                <h3>当前配置</h3>
                <div class="info-item">
                  <span class="info-label">API 地址</span>
                  <code id="current-api" class="info-value">未配置</code>
                  <button type="button" class="ghost" data-copy="current-api">复制</button>
                </div>
                <div class="info-item">
                  <span class="info-label">API 密钥</span>
                  <code id="current-key" class="info-value">未配置</code>
                  <button type="button" class="ghost" data-copy="current-key">复制</button>
                </div>
              </div>
              <div class="info-card">
                <h3>示例命令</h3>
                <p class="muted">使用 curl 调用上传接口：</p>
                <pre class="code-block" id="example-upload">curl -X POST "https://api.example.com/api/upload" \
  -H "X-API-Key: YOUR_API_KEY" \
  -F "images=@/path/to/image.jpg"</pre>
                <button type="button" class="ghost" data-copy="example-upload">复制命令</button>
                <p class="muted">获取历史记录：</p>
                <pre class="code-block" id="example-history">curl "https://api.example.com/api/images" \
  -H "X-API-Key: YOUR_API_KEY"</pre>
                <button type="button" class="ghost" data-copy="example-history">复制命令</button>
              </div>
            </div>
          </div>
        </section>
      </main>

      <div id="status" class="toast" role="status" aria-live="polite"></div>
    </div>

    <script type="module" src="/assets/app.js"></script>
  </body>
</html>
